<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¹ì›ê´‘ì¥ - ë¯¸ë˜ì—°ëŒ€ë‹¹</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap" rel="stylesheet">
    <script src="/common.js"></script>
    <style>
        :root { --brand-blue: #007acc; --brand-navy: #1d458b; --text-gray: #333; }
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #f8f9fa; color: var(--text-gray); }

        /* í—¤ë” ìŠ¤íƒ€ì¼ (index.htmlê³¼ ë™ì¼) */
        .main-header { background: #fff; border-bottom: 1px solid #e1e1e1; height: 80px; display: flex; align-items: center; justify-content: center; }
        .nav-container { width: 100%; max-width: 1200px; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; font-weight: 800; text-decoration: none; color: var(--brand-navy); }

        /* ê²Œì‹œíŒ ì»¨í…Œì´ë„ˆ */
        .board-container { max-width: 900px; margin: 50px auto; padding: 20px; }
        .board-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .board-title { font-size: 32px; font-weight: 800; color: var(--brand-navy); }
        .btn-write { background: var(--brand-blue); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-write:hover { background: var(--brand-navy); }

        /* ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .post-list { list-style: none; padding: 0; margin: 0; }
        .post-item { background: white; border: 1px solid #e1e1e1; border-radius: 12px; padding: 25px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); transition: 0.2s; }
        .post-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .post-top { display: flex; justify-content: space-between; font-size: 14px; color: #888; margin-bottom: 10px; }
        .post-author { font-weight: bold; color: var(--brand-navy); }
        .post-title { font-size: 20px; font-weight: bold; margin: 0 0 10px 0; color: #333; }
        .post-content { font-size: 16px; color: #555; line-height: 1.6; white-space: pre-wrap; }

        /* ê¸€ì“°ê¸° ëª¨ë‹¬ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input, .input-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .input-group textarea { height: 150px; resize: vertical; }
        .btn-submit { width: 100%; padding: 15px; background: var(--brand-navy); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header class="main-header">
        <div class="nav-container">
            <a href="/" class="logo">ë¯¸ë˜ì—°ëŒ€ë‹¹ ë‹¹ì›ê´‘ì¥</a>
            <a href="/" style="text-decoration:none; color:#666; font-weight:bold;">ğŸ  ë©”ì¸ìœ¼ë¡œ</a>
        </div>
    </header>

    <div class="board-container">
        <div class="board-header">
            <div class="board-title">ğŸ—£ï¸ ììœ ê²Œì‹œíŒ</div>
            <button class="btn-write" onclick="openWriteModal()">âœï¸ ê¸€ì“°ê¸°</button>
        </div>

        <ul class="post-list" id="postList">
            <li style="text-align:center; padding:40px; color:#888;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</li>
        </ul>
    </div>

    <div class="modal" id="writeModal">
        <div class="modal-content">
            <h3 style="margin-top:0;">ìƒˆë¡œìš´ ê¸€ ì‘ì„±</h3>
            <div class="input-group">
                <label>ì œëª©</label>
                <input type="text" id="postTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="input-group">
                <label>ë‚´ìš©</label>
                <textarea id="postContent" placeholder="ë‹¹ì›ë“¤ê³¼ ë‚˜ëˆ„ê³  ì‹¶ì€ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”"></textarea>
            </div>
            <button class="btn-submit" onclick="submitPost()">ë“±ë¡í•˜ê¸°</button>
            <p onclick="closeWriteModal()" style="text-align:center; cursor:pointer; color:#888; margin-top:15px;">ë‹«ê¸°</p>
        </div>
    </div>

    <script>
        // 0. ë³´ì•ˆ ê²€ë¬¸ (ë‹¹ì› ì•„ë‹ˆë©´ ì«“ì•„ëƒ„)
        const currentUser = localStorage.getItem('userName');
        if (!currentUser) {
            alert("ë‹¹ì› ì „ìš© ê³µê°„ì…ë‹ˆë‹¤.");
            location.href = "/";
        }

        // 1. ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadPosts() {
            try {
                const res = await fetch('/api/community');
                const posts = await res.json();
                const list = document.getElementById('postList');
                
                if (posts.length === 0) {
                    list.innerHTML = `<li style="text-align:center; padding:50px; color:#888;">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ê¸€ì˜ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”!</li>`;
                    return;
                }

                list.innerHTML = posts.map(post => `
                    <li class="post-item">
                        <div class="post-top">
                            <span class="post-author">${post.author} ë‹¹ì›</span>
                            <span>${new Date(post.created_at).toLocaleDateString()}</span>
                        </div>
                        <h3 class="post-title">${post.title}</h3>
                        <div class="post-content">${post.content}</div>
                    </li>
                `).join('');
            } catch (e) { console.error(e); }
        }

        // 2. ê¸€ ì‘ì„±í•˜ê¸°
        async function submitPost() {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            if (!title || !content) { alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

            try {
                const res = await fetch('/api/community', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        title, 
                        content, 
                        author: currentUser // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” ë‚´ ì´ë¦„ìœ¼ë¡œ ì‘ì„±
                    })
                });

                if (res.ok) {
                    alert("ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    closeWriteModal();
                    loadPosts(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                } else { alert("ë“±ë¡ ì‹¤íŒ¨"); }
            } catch (e) { alert("ì„œë²„ ì˜¤ë¥˜"); }
        }

        // ëª¨ë‹¬ ì œì–´
        function openWriteModal() { document.getElementById('writeModal').style.display = 'flex'; }
        function closeWriteModal() { document.getElementById('writeModal').style.display = 'none'; }

        // ì‹œì‘ ì‹œ ì‹¤í–‰
        loadPosts();
    </script>
</body>
</html>
